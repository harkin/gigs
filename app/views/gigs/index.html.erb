<div class="max-w-4xl mx-auto">
  <!-- Header Section -->
  <div class="text-center mb-8">
    <h1 class="text-4xl font-bold text-gray-900 mb-4">Dublin Gigs</h1>
    <div class="flex flex-col sm:flex-row gap-4 justify-center items-center mb-6">
      <div class="stats-card">
        <div class="text-2xl font-bold text-blue-600"><%= Event.count %></div>
        <div class="text-sm text-gray-600">Events</div>
      </div>
      <div class="stats-card">
        <div class="text-2xl font-bold text-green-600"><%= Event.venues.count %></div>
        <div class="text-sm text-gray-600">Venues</div>
      </div>
    </div>
    
    <p class="text-gray-600 mb-4">Last updated: <%= @last_refreshed_at&.to_formatted_s(:short) || "Never" %></p>
    
    <% if @last_refreshed_at.blank? || @last_refreshed_at < 1.day.ago %>
      <div class="refresh-banner">
        <p class="text-yellow-800 font-medium">
          ğŸ”„ Events may be outdated. 
          <a href="/refresh" class="font-semibold hover:underline">Click here to refresh</a>
          (takes a few seconds)
        </p>
      </div>
    <% end %>
  </div>

  <!-- Events Section -->
  <% @events.each do |year, events_by_month| %>
    <% events_by_month.each do |month, events| %>
      <div class="month-section">
        <h2 class="month-header"><%= "#{Date::MONTHNAMES[month]} #{year}" %></h2>
        
        <div class="space-y-4">
          <% events.each do |event| %>
            <div class="event-card">
              <div class="flex flex-col lg:flex-row lg:items-start lg:justify-between gap-4">
                <!-- Main Event Info -->
                <div class="flex-1">
                  <h3 class="event-title"><%== event.title %></h3>
                  <div class="flex flex-wrap items-center gap-3 mb-3">
                    <span class="event-venue"><%= event.renderable_venue %></span>
                    <span class="event-date">
                      <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                      </svg>
                      <%= event.event_date %>
                    </span>
                  </div>
                </div>

                <!-- Status and Actions -->
                <div class="flex flex-col sm:flex-row gap-3 items-start sm:items-center">
                  <% ticket_status_class = case event.ticket_status
                                             when "available" then "status-available"
                                             when "limited_availability" then "status-limited"
                                             when "sold_out" then "status-sold-out"
                                             else "status-unknown"
                                           end %>
                  
                  <% if event.link_to_buy_ticket.present? %>
                    <a href="<%= event.link_to_buy_ticket %>" class="status-badge <%= ticket_status_class %>">
                      <%= event.renderable_ticket_status %>
                    </a>
                  <% else %>
                    <span class="status-badge <%= ticket_status_class %>">
                      <%= event.renderable_ticket_status %>
                    </span>
                  <% end %>
                  
                  <% if event.more_info.present? %>
                    <a href="<%= event.more_info %>" class="btn-secondary">
                      <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                      </svg>
                      More Info
                    </a>
                  <% end %>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  <% end %>
</div>
